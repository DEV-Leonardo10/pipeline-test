name: Pipeline HTML/CSS

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Clonar o c√≥digo
        uses: actions/checkout@v4

      - name: Verificar estrutura de arquivos
        run: |
          echo "‚úÖ C√≥digo HTML e CSS recebidos com sucesso!"
          ls -la

  test:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - name: Clonar o c√≥digo
        uses: actions/checkout@v4

      - name: Validar HTML
        run: |
          sudo apt-get update
          sudo apt-get install -y tidy
          for file in *.html; do
            echo "Validando $file..."
            tidy -qe "$file" || exit 1
          done

      - name: Validar CSS
        run: |
          npm install --save-dev stylelint stylelint-config-standard
          npx stylelint "**/*.css" || exit 1

  sast:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - name: Clonar o c√≥digo
        uses: actions/checkout@v4

      - name: Rodar SAST HTML
        run: |
          npm install --save-dev htmllint
          for file in *.html; do
            echo "üîç Analisando $file..."
            npx htmllint "$file" || exit 1
          done

      - name: Rodar SAST CSS
        run: |
          npm install --save-dev stylelint stylelint-config-standard
          npx stylelint "**/*.css" || exit 1

  dast:
    needs: sast
    runs-on: ubuntu-latest
    steps:
      - name: Clonar o c√≥digo
        uses: actions/checkout@v4

      - name: Rodar DAST (exemplo)
        run: |
          echo "üïµÔ∏è Rodando an√°lise din√¢mica (DAST) simulada..."
          # Aqui voc√™ pode integrar ferramentas como OWASP ZAP, Nikto, etc.
          echo "DAST conclu√≠do com sucesso!"

  deploy:
    needs: dast
    runs-on: ubuntu-latest
    steps:
      - name: Deploy (exemplo)
        run: |
          echo "üöÄ Deploy iniciado..."
          # Aqui voc√™ pode colocar seu script real de deploy
          echo "Deploy conclu√≠do com sucesso!"
